<figure class="demo-container" style="max-width: 230px">
    <div class="bd-container" id="nacl-saturation-container"></div>
</figure>

<script type="module">
    const plotContainerId = 'nacl-saturation-container';

    import ElectrochemicalSpeciesBandDiagram from '{{ esbdJsPath }}ElectrochemicalSpeciesBandDiagram.js';
    import { formatPopupBaseContent, throttle } from '{{ esbdJsPath }}utils.js';

    const speciesInfo = {
        cation: {
            z: 1,
            color: '#d87E37',
            mathLabel: '\\mathrm{Na}^{+}',
        },
        anion: {
            z: -1,
            color: '#80B030',
            mathLabel: '\\mathrm{Cl}^{-}',
        },
    };

    const diagram = new ElectrochemicalSpeciesBandDiagram(
        plotContainerId,
        speciesInfo
    );

    // Set layout
    const boundaries = [0, 0.5, 1];
    diagram.setSpatialLayout(boundaries, [
        { name: 'NaCl solid', color: '#eee' },
        { name: 'Brine', color: '#E6F5FF' },
    ]);

    const Delta = -3.9813; // V

    const V_cat = -0.789; //random
    const V_an = V_cat - Delta;
    diagram.setVRange(Math.min(V_cat, V_an) - 0.2, Math.max(V_cat, V_an) + 0.2);

    const b = boundaries;
    diagram.updateTraceData([
        {
            id: `anion_trace`,
            speciesId: 'anion',
            curveType: 'voltage',
            showLabel: true,
            x: [b[1], b[2]],
            y: [V_an, V_an],
        },
        {
            id: `cation_trace`,
            speciesId: 'cation',
            curveType: 'voltage',
            showLabel: true,
            x: [b[1], b[2]],
            y: [V_cat, V_cat],
        },
    ]);

    diagram.updateVerticalMarkers([
        {
            id: 'reaction',
            symbol: 'â‡Œ',
            x: 0.5,
            yDefs: [{ y: V_an }, { y: V_cat }],
            popupCallback: () =>
                '$ \\mathrm{Na}^+ + \\mathrm{Cl}^- \\rightleftharpoons \\mathrm{NaCl}. $',
        },
    ]);
</script>
